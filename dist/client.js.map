{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/browserify/node_modules/events/events.js","src/client.js","src/roll_standalone.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"client.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var EventEmitter = require('events').EventEmitter;\n\n/**\n * Roll simply keep tracks of steps' positions inside a viewport.\n * Apart from the static helper functions and the `scroll` function, a roll instance doesn't depend on DOM manipulation.\n * That means you can use a Roll instance in contexts other than DOM.\n */\nexport default class Roll extends EventEmitter {\n\n  /**\n   * Create a new Roll.\n   * @param viewSize viewport size (single dimension)\n   */\n  constructor( viewSize ) {\n    super();\n\n    this.viewportSize = viewSize;\n    this.paneSize = 0;\n\n    // store the steps object {y1, y2, size, pad}, See Roll.chunk\n    this.steps = [];\n\n    this.pos = 0; // current position\n    this.current = 0; // current step\n    this.last = -1; // last step\n\n    this.movingInterval = -1;\n  }\n\n\n  /**\n   * Add a step object. You can also use Roll.chunk() static helper function to create a step object easily.\n   * @param s an object with {p1, p2, size, pad} properties, or an array of steps object\n   * @returns {Roll}\n   */\n  addStep(s) {\n\n    if (!Array.isArray(s)) {\n      s = [s];\n    }\n\n    // get last recorded step\n    var d = s[0].p1;\n    if (this.steps.length > 0 ) {\n      var last = this.steps[this.steps.length-1];\n      d = last.p2 + last.pad;\n    }\n\n    // append new steps\n    for (var i=0; i<s.length; i++) {\n      s[i].p1 = d;\n      s[i].p2 = s[i].p1 + s[i].size;\n      d = s[i].p2 + s[i].pad;\n      this.steps.push( s[i] );\n    }\n\n    // recalculate pane size\n    this.getHeight( true );\n\n    return this;\n  }\n\n\n  /**\n   * Get step by index\n   * @param index\n   */\n  getStepAt( index ) {\n    return this.steps[ Math.max( 0, Math.min( this.steps.length-1, index) )];\n  }\n\n\n  /**\n   * Calculate and return current step. When padding > 0, step will be -1 when current progress is on the padding area. This allows you to check progress against padding.\n   * @returns {number}\n   */\n  getStep() {\n    for (var i=0; i<this.steps.length; i++) {\n      var st = this.steps[i];\n      if (st.p1 >= -this.viewportSize && st.p2 <= st.size ) {\n        this.current = i;\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Get current progress within the current step\n   * @returns 0-1 if step.pad is 0. Otherwise it will range from negative to positive.\n   */\n  getStepProgress() {\n    var curr = this.steps[ this.current ];\n    return 1 - (curr.p2 / curr.size);\n  }\n\n\n  /**\n   * Get current position\n   * @returns {number|*}\n   */\n  getPosition() {\n    return this.pos;\n  }\n\n  /**\n   * Get total height of the pane (including padding)\n   * @returns {*}\n   */\n  getHeight( recalc = false ) {\n    if (recalc ) this.paneSize = this.steps.reduce( (a,b) => a+b.size+b.pad, 0 );\n    return this.paneSize;\n  }\n\n  /**\n   * Get viewport's height (same as this.viewportSize)\n   * @returns {*}\n   */\n  getViewportHeight() {\n    return this.viewportSize;\n  }\n\n\n  /**\n   * Move the roll. This will emit two events `roll(step, currProgress, currPosition, totalProgress)` and `step(curr, last)`\n   * @param pos new position\n   * @returns {Roll}\n   */\n  move( pos ) {\n    var last = this.pos;\n    this.pos = -pos;\n    var diff = this.pos - last;\n\n    for (var i=0; i<this.steps.length; i++) {\n      let s = this.steps[i];\n      s.p1 += diff;\n      s.p2 = s.p1 + s.size;\n    }\n\n    var curr = this.getStep();\n    var progress = this.getStepProgress();\n    this.emit(\"roll\", curr, progress, pos, pos/(this.paneSize-this.viewportSize) );\n\n    if (curr != this.last && curr >= 0) {\n      this.emit(\"step\", curr, this.last, this.viewportSize );\n      this.last = curr;\n    }\n\n    return this;\n  }\n\n\n  /**\n   * Animated scrolling a DOM element\n   * @param index step index\n   * @param scrollPane a DOM element with scrolling (overflow-y).\n   * @param speed optional speed of animated scroll. Defaults to 0.1. Larger is faster\n   * @param isVertical optional boolean to indicate horizontal or vertical scroll\n   */\n  scroll( index, scrollPane, speed=0.1, isVertical=true) {\n    if (!scrollPane || scrollPane.scrollTop == null) throw \"scrollPane parameter requires a DOM element with scrollTop property\";\n    clearInterval( this.movingInterval );\n    var _temp = Number.NEGATIVE_INFINITY;\n    var dir = (isVertical) ? \"scrollTop\" : \"scrollLeft\";\n\n    this.movingInterval = setInterval( () => {\n      var target = this.getStepAt(index);\n      var d = (target.p1 + target.size/4) * speed;\n      scrollPane[dir] += d;\n      if (Math.abs(d)<1 || _temp === scrollPane[dir]) clearInterval(this.movingInterval);\n      _temp = scrollPane[dir];\n    }, 17);\n  }\n\n\n  /**\n   * A convenient static function to create a step object\n   * @param size chunk size\n   * @param pad optional padding (default to 0)\n   * @returns {{p1: number, p2: *, size: *, pad: number}}\n   */\n  static chunk( size, pad=0) {\n    return {\n      p1: 0,\n      p2: size,\n      size: size,\n      pad: pad\n    }\n  }\n\n\n  /**\n   * A convenient static function to compare a step with current step, and transform it to a name\n   * @param step the step to check\n   * @param currStep current step\n   * @param prev optional class name for step is < currStep. Defaults to \"prev\"\n   * @param next optional class name for step is > currStep. Defaults to \"next\"\n   * @param match optional class name for step = currStep. Defaults to \"curr\"\n   * @returns {string}\n   */\n  static stepName( step, currStep, prev=\"prev\", next=\"next\", match=\"curr\") {\n    return (step === currStep) ? match : ( (step < currStep) ? prev : next );\n  }\n\n\n  /**\n   * Static helper to get a handle function for Roll's \"step\" event. The handler function will add class names to each step element based on current step value.\n   * @param roll a Roll instance\n   * @param views a list of DOM elements which are the steps\n   * @param prev optional class name for step is < currStep. Defaults to \"prev\"\n   * @param next optional class name for step is > currStep. Defaults to \"next\"\n   * @param match optional class name for step = currStep. Defaults to \"curr\"\n   * @returns {Function}\n   */\n  static stepHandler( roll, views, prev=\"prev\", next=\"next\", match=\"curr\", trackTopPos=false) {\n    return function ( curr, last, viewportHeight ) {\n      for (var i = 0; i < roll.steps.length; i++) {\n        var cls = Roll.stepName( i, curr, prev, next, match );\n        views[i].className = \"step \" + cls;\n\n        // if steps have different sizes, recalc top position and set style\n        if (trackTopPos) {\n          var p = (cls===prev) ?  roll.steps[i].size * -1 : ((cls===next) ? viewportHeight : 0);\n          views[i].style.top = p+\"px\";\n        }\n      }\n    }\n  }\n\n\n  /**\n   * Static method to create a Roll instance with DOM elements\n   * @param viewPortID id of viewport element, which is the parent of the viewPane. eg, \"#viewport\"\n   * @param viewPaneID id of view pane element, eg, \"#pane\"\n   * @param viewBox id of view box element, which is the parent the viewClass elements. eg, \"#steps\"\n   * @param viewClass id of each step or slide element, eg, \".step\"\n   * @param pad optional padding between steps. Defaults to 0.\n   * @returns the roll instance which you can listen for \"step\" and \"roll\" event via `roll.on(...)`\n   */\n  static DOM( viewPortID, viewPaneID, viewBoxID, viewClass, pad=0 ) {\n\n    var viewport = document.querySelector( viewPortID );\n    var viewpane = viewport.querySelector( viewPaneID );\n    var viewbox = document.querySelector( viewBoxID );\n    var views = viewbox.querySelectorAll( viewClass );\n\n    if (!viewport || !viewpane) throw `Cannot find ${viewPortID} or ${viewPaneID} element id.`\n    if (!viewClass) throw `Cannot find ${viewClass} element class name`;\n\n    // create roll instance based on viewport element height\n    var roll = new Roll( viewport.getBoundingClientRect().height );\n\n    // add each viewClass element as a step\n    for (var i = 0; i < views.length; i++) {\n      var rect = views[i].getBoundingClientRect();\n      roll.addStep( Roll.chunk( rect.height, pad ) );\n    }\n\n    // update viewpane height based on steps\n    viewpane.style.height = roll.getHeight()+\"px\";\n\n    // update viewbox width to account for scrollbar\n    viewbox.style.width = viewpane.getBoundingClientRect().width+\"px\";\n\n    // track scroll\n    viewport.addEventListener(\"scroll\", function(evt) {\n      roll.move( viewport.scrollTop );\n    });\n\n    return roll;\n  }\n\n}\n","var Roll = require(\"./client.js\");\n\nif (window) window.Roll = Roll;\n\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvZXZlbnRzL2V2ZW50cy5qcyIsIi9Vc2Vycy9ybmphaWxhbWJhL0Rlc2t0b3AvbWVzc2FnZV9jbGllbnRfb25fc29ja2V0aW8vc3JjL2NsaWVudC5qcyIsIi9Vc2Vycy9ybmphaWxhbWJhL0Rlc2t0b3AvbWVzc2FnZV9jbGllbnRfb25fc29ja2V0aW8vc3JjL3JvbGxfc3RhbmRhbG9uZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUMsU0FBUyxFQUFFLHVCQUFxQixTQUFTLHlCQUFzQjs7O0FBR3BFLFVBQUksSUFBSSxHQUFHLElBQUksSUFBSSxDQUFFLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBRSxDQUFDOzs7QUFHL0QsV0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDckMsWUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixFQUFFLENBQUM7QUFDNUMsWUFBSSxDQUFDLE9BQU8sQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFFLENBQUUsQ0FBQztPQUNoRDs7O0FBR0QsY0FBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFDLElBQUksQ0FBQzs7O0FBRzlDLGFBQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEtBQUssR0FBQyxJQUFJLENBQUM7OztBQUdsRSxjQUFRLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFVBQVMsR0FBRyxFQUFFO0FBQ2hELFlBQUksQ0FBQyxJQUFJLENBQUUsUUFBUSxDQUFDLFNBQVMsQ0FBRSxDQUFDO09BQ2pDLENBQUMsQ0FBQzs7QUFFSCxhQUFPLElBQUksQ0FBQztLQUNiOzs7U0F2UWtCLElBQUk7R0FBUyxZQUFZOztxQkFBekIsSUFBSTs7Ozs7O0FDUHpCLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQzs7QUFFbEMsSUFBSSxNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbmZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHtcbiAgdGhpcy5fZXZlbnRzID0gdGhpcy5fZXZlbnRzIHx8IHt9O1xuICB0aGlzLl9tYXhMaXN0ZW5lcnMgPSB0aGlzLl9tYXhMaXN0ZW5lcnMgfHwgdW5kZWZpbmVkO1xufVxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG5cbi8vIEJhY2t3YXJkcy1jb21wYXQgd2l0aCBub2RlIDAuMTAueFxuRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkO1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdW5kZWZpbmVkO1xuXG4vLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmVcbi8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuXG5FdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycyA9IDEwO1xuXG4vLyBPYnZpb3VzbHkgbm90IGFsbCBFbWl0dGVycyBzaG91bGQgYmUgbGltaXRlZCB0byAxMC4gVGhpcyBmdW5jdGlvbiBhbGxvd3Ncbi8vIHRoYXQgdG8gYmUgaW5jcmVhc2VkLiBTZXQgdG8gemVybyBmb3IgdW5saW1pdGVkLlxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbihuKSB7XG4gIGlmICghaXNOdW1iZXIobikgfHwgbiA8IDAgfHwgaXNOYU4obikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCduIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBlciwgaGFuZGxlciwgbGVuLCBhcmdzLCBpLCBsaXN0ZW5lcnM7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMpXG4gICAgdGhpcy5fZXZlbnRzID0ge307XG5cbiAgLy8gSWYgdGhlcmUgaXMgbm8gJ2Vycm9yJyBldmVudCBsaXN0ZW5lciB0aGVuIHRocm93LlxuICBpZiAodHlwZSA9PT0gJ2Vycm9yJykge1xuICAgIGlmICghdGhpcy5fZXZlbnRzLmVycm9yIHx8XG4gICAgICAgIChpc09iamVjdCh0aGlzLl9ldmVudHMuZXJyb3IpICYmICF0aGlzLl9ldmVudHMuZXJyb3IubGVuZ3RoKSkge1xuICAgICAgZXIgPSBhcmd1bWVudHNbMV07XG4gICAgICBpZiAoZXIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBlcjsgLy8gVW5oYW5kbGVkICdlcnJvcicgZXZlbnRcbiAgICAgIH1cbiAgICAgIHRocm93IFR5cGVFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudC4nKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVyID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIGlmIChpc1VuZGVmaW5lZChoYW5kbGVyKSlcbiAgICByZXR1cm4gZmFsc2U7XG5cbiAgaWYgKGlzRnVuY3Rpb24oaGFuZGxlcikpIHtcbiAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgIC8vIGZhc3QgY2FzZXNcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGFyZ3VtZW50c1sxXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBoYW5kbGVyLmNhbGwodGhpcywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIHNsb3dlclxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICAgICAgZm9yIChpID0gMTsgaSA8IGxlbjsgaSsrKVxuICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldO1xuICAgICAgICBoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChpc09iamVjdChoYW5kbGVyKSkge1xuICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcbiAgICBmb3IgKGkgPSAxOyBpIDwgbGVuOyBpKyspXG4gICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcblxuICAgIGxpc3RlbmVycyA9IGhhbmRsZXIuc2xpY2UoKTtcbiAgICBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoO1xuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKylcbiAgICAgIGxpc3RlbmVyc1tpXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gIHZhciBtO1xuXG4gIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBpZiAoIXRoaXMuX2V2ZW50cylcbiAgICB0aGlzLl9ldmVudHMgPSB7fTtcblxuICAvLyBUbyBhdm9pZCByZWN1cnNpb24gaW4gdGhlIGNhc2UgdGhhdCB0eXBlID09PSBcIm5ld0xpc3RlbmVyXCIhIEJlZm9yZVxuICAvLyBhZGRpbmcgaXQgdG8gdGhlIGxpc3RlbmVycywgZmlyc3QgZW1pdCBcIm5ld0xpc3RlbmVyXCIuXG4gIGlmICh0aGlzLl9ldmVudHMubmV3TGlzdGVuZXIpXG4gICAgdGhpcy5lbWl0KCduZXdMaXN0ZW5lcicsIHR5cGUsXG4gICAgICAgICAgICAgIGlzRnVuY3Rpb24obGlzdGVuZXIubGlzdGVuZXIpID9cbiAgICAgICAgICAgICAgbGlzdGVuZXIubGlzdGVuZXIgOiBsaXN0ZW5lcik7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgLy8gT3B0aW1pemUgdGhlIGNhc2Ugb2Ygb25lIGxpc3RlbmVyLiBEb24ndCBuZWVkIHRoZSBleHRyYSBhcnJheSBvYmplY3QuXG4gICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gbGlzdGVuZXI7XG4gIGVsc2UgaWYgKGlzT2JqZWN0KHRoaXMuX2V2ZW50c1t0eXBlXSkpXG4gICAgLy8gSWYgd2UndmUgYWxyZWFkeSBnb3QgYW4gYXJyYXksIGp1c3QgYXBwZW5kLlxuICAgIHRoaXMuX2V2ZW50c1t0eXBlXS5wdXNoKGxpc3RlbmVyKTtcbiAgZWxzZVxuICAgIC8vIEFkZGluZyB0aGUgc2Vjb25kIGVsZW1lbnQsIG5lZWQgdG8gY2hhbmdlIHRvIGFycmF5LlxuICAgIHRoaXMuX2V2ZW50c1t0eXBlXSA9IFt0aGlzLl9ldmVudHNbdHlwZV0sIGxpc3RlbmVyXTtcblxuICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVha1xuICBpZiAoaXNPYmplY3QodGhpcy5fZXZlbnRzW3R5cGVdKSAmJiAhdGhpcy5fZXZlbnRzW3R5cGVdLndhcm5lZCkge1xuICAgIHZhciBtO1xuICAgIGlmICghaXNVbmRlZmluZWQodGhpcy5fbWF4TGlzdGVuZXJzKSkge1xuICAgICAgbSA9IHRoaXMuX21heExpc3RlbmVycztcbiAgICB9IGVsc2Uge1xuICAgICAgbSA9IEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzO1xuICAgIH1cblxuICAgIGlmIChtICYmIG0gPiAwICYmIHRoaXMuX2V2ZW50c1t0eXBlXS5sZW5ndGggPiBtKSB7XG4gICAgICB0aGlzLl9ldmVudHNbdHlwZV0ud2FybmVkID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJyhub2RlKSB3YXJuaW5nOiBwb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5ICcgK1xuICAgICAgICAgICAgICAgICAgICAnbGVhayBkZXRlY3RlZC4gJWQgbGlzdGVuZXJzIGFkZGVkLiAnICtcbiAgICAgICAgICAgICAgICAgICAgJ1VzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0LicsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXS5sZW5ndGgpO1xuICAgICAgaWYgKHR5cGVvZiBjb25zb2xlLnRyYWNlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIG5vdCBzdXBwb3J0ZWQgaW4gSUUgMTBcbiAgICAgICAgY29uc29sZS50cmFjZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICB2YXIgZmlyZWQgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBnKCkge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgZyk7XG5cbiAgICBpZiAoIWZpcmVkKSB7XG4gICAgICBmaXJlZCA9IHRydWU7XG4gICAgICBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cbiAgfVxuXG4gIGcubGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgdGhpcy5vbih0eXBlLCBnKTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8vIGVtaXRzIGEgJ3JlbW92ZUxpc3RlbmVyJyBldmVudCBpZmYgdGhlIGxpc3RlbmVyIHdhcyByZW1vdmVkXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgdmFyIGxpc3QsIHBvc2l0aW9uLCBsZW5ndGgsIGk7XG5cbiAgaWYgKCFpc0Z1bmN0aW9uKGxpc3RlbmVyKSlcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzIHx8ICF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgcmV0dXJuIHRoaXM7XG5cbiAgbGlzdCA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgbGVuZ3RoID0gbGlzdC5sZW5ndGg7XG4gIHBvc2l0aW9uID0gLTE7XG5cbiAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8XG4gICAgICAoaXNGdW5jdGlvbihsaXN0Lmxpc3RlbmVyKSAmJiBsaXN0Lmxpc3RlbmVyID09PSBsaXN0ZW5lcikpIHtcbiAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgIGlmICh0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIpXG4gICAgICB0aGlzLmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgdHlwZSwgbGlzdGVuZXIpO1xuXG4gIH0gZWxzZSBpZiAoaXNPYmplY3QobGlzdCkpIHtcbiAgICBmb3IgKGkgPSBsZW5ndGg7IGktLSA+IDA7KSB7XG4gICAgICBpZiAobGlzdFtpXSA9PT0gbGlzdGVuZXIgfHxcbiAgICAgICAgICAobGlzdFtpXS5saXN0ZW5lciAmJiBsaXN0W2ldLmxpc3RlbmVyID09PSBsaXN0ZW5lcikpIHtcbiAgICAgICAgcG9zaXRpb24gPSBpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb24gPCAwKVxuICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICBpZiAobGlzdC5sZW5ndGggPT09IDEpIHtcbiAgICAgIGxpc3QubGVuZ3RoID0gMDtcbiAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3Quc3BsaWNlKHBvc2l0aW9uLCAxKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3RlbmVyKTtcbiAgfVxuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciBrZXksIGxpc3RlbmVycztcblxuICBpZiAoIXRoaXMuX2V2ZW50cylcbiAgICByZXR1cm4gdGhpcztcblxuICAvLyBub3QgbGlzdGVuaW5nIGZvciByZW1vdmVMaXN0ZW5lciwgbm8gbmVlZCB0byBlbWl0XG4gIGlmICghdGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApXG4gICAgICB0aGlzLl9ldmVudHMgPSB7fTtcbiAgICBlbHNlIGlmICh0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChrZXkgaW4gdGhpcy5fZXZlbnRzKSB7XG4gICAgICBpZiAoa2V5ID09PSAncmVtb3ZlTGlzdGVuZXInKSBjb250aW51ZTtcbiAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7XG4gICAgfVxuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCdyZW1vdmVMaXN0ZW5lcicpO1xuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbGlzdGVuZXJzID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIGlmIChpc0Z1bmN0aW9uKGxpc3RlbmVycykpIHtcbiAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVycyk7XG4gIH0gZWxzZSB7XG4gICAgLy8gTElGTyBvcmRlclxuICAgIHdoaWxlIChsaXN0ZW5lcnMubGVuZ3RoKVxuICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnNbbGlzdGVuZXJzLmxlbmd0aCAtIDFdKTtcbiAgfVxuICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlKSB7XG4gIHZhciByZXQ7XG4gIGlmICghdGhpcy5fZXZlbnRzIHx8ICF0aGlzLl9ldmVudHNbdHlwZV0pXG4gICAgcmV0ID0gW107XG4gIGVsc2UgaWYgKGlzRnVuY3Rpb24odGhpcy5fZXZlbnRzW3R5cGVdKSlcbiAgICByZXQgPSBbdGhpcy5fZXZlbnRzW3R5cGVdXTtcbiAgZWxzZVxuICAgIHJldCA9IHRoaXMuX2V2ZW50c1t0eXBlXS5zbGljZSgpO1xuICByZXR1cm4gcmV0O1xufTtcblxuRXZlbnRFbWl0dGVyLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7XG4gIHZhciByZXQ7XG4gIGlmICghZW1pdHRlci5fZXZlbnRzIHx8ICFlbWl0dGVyLl9ldmVudHNbdHlwZV0pXG4gICAgcmV0ID0gMDtcbiAgZWxzZSBpZiAoaXNGdW5jdGlvbihlbWl0dGVyLl9ldmVudHNbdHlwZV0pKVxuICAgIHJldCA9IDE7XG4gIGVsc2VcbiAgICByZXQgPSBlbWl0dGVyLl9ldmVudHNbdHlwZV0ubGVuZ3RoO1xuICByZXR1cm4gcmV0O1xufTtcblxuZnVuY3Rpb24gaXNGdW5jdGlvbihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdmdW5jdGlvbic7XG59XG5cbmZ1bmN0aW9uIGlzTnVtYmVyKGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ251bWJlcic7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ29iamVjdCcgJiYgYXJnICE9PSBudWxsO1xufVxuXG5mdW5jdGlvbiBpc1VuZGVmaW5lZChhcmcpIHtcbiAgcmV0dXJuIGFyZyA9PT0gdm9pZCAwO1xufVxuIiwidmFyIEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpLkV2ZW50RW1pdHRlcjtcblxuLyoqXG4gKiBSb2xsIHNpbXBseSBrZWVwIHRyYWNrcyBvZiBzdGVwcycgcG9zaXRpb25zIGluc2lkZSBhIHZpZXdwb3J0LlxuICogQXBhcnQgZnJvbSB0aGUgc3RhdGljIGhlbHBlciBmdW5jdGlvbnMgYW5kIHRoZSBgc2Nyb2xsYCBmdW5jdGlvbiwgYSByb2xsIGluc3RhbmNlIGRvZXNuJ3QgZGVwZW5kIG9uIERPTSBtYW5pcHVsYXRpb24uXG4gKiBUaGF0IG1lYW5zIHlvdSBjYW4gdXNlIGEgUm9sbCBpbnN0YW5jZSBpbiBjb250ZXh0cyBvdGhlciB0aGFuIERPTS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9sbCBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBSb2xsLlxuICAgKiBAcGFyYW0gdmlld1NpemUgdmlld3BvcnQgc2l6ZSAoc2luZ2xlIGRpbWVuc2lvbilcbiAgICovXG4gIGNvbnN0cnVjdG9yKCB2aWV3U2l6ZSApIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy52aWV3cG9ydFNpemUgPSB2aWV3U2l6ZTtcbiAgICB0aGlzLnBhbmVTaXplID0gMDtcblxuICAgIC8vIHN0b3JlIHRoZSBzdGVwcyBvYmplY3Qge3kxLCB5Miwgc2l6ZSwgcGFkfSwgU2VlIFJvbGwuY2h1bmtcbiAgICB0aGlzLnN0ZXBzID0gW107XG5cbiAgICB0aGlzLnBvcyA9IDA7IC8vIGN1cnJlbnQgcG9zaXRpb25cbiAgICB0aGlzLmN1cnJlbnQgPSAwOyAvLyBjdXJyZW50IHN0ZXBcbiAgICB0aGlzLmxhc3QgPSAtMTsgLy8gbGFzdCBzdGVwXG5cbiAgICB0aGlzLm1vdmluZ0ludGVydmFsID0gLTE7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBBZGQgYSBzdGVwIG9iamVjdC4gWW91IGNhbiBhbHNvIHVzZSBSb2xsLmNodW5rKCkgc3RhdGljIGhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgYSBzdGVwIG9iamVjdCBlYXNpbHkuXG4gICAqIEBwYXJhbSBzIGFuIG9iamVjdCB3aXRoIHtwMSwgcDIsIHNpemUsIHBhZH0gcHJvcGVydGllcywgb3IgYW4gYXJyYXkgb2Ygc3RlcHMgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtSb2xsfVxuICAgKi9cbiAgYWRkU3RlcChzKSB7XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocykpIHtcbiAgICAgIHMgPSBbc107XG4gICAgfVxuXG4gICAgLy8gZ2V0IGxhc3QgcmVjb3JkZWQgc3RlcFxuICAgIHZhciBkID0gc1swXS5wMTtcbiAgICBpZiAodGhpcy5zdGVwcy5sZW5ndGggPiAwICkge1xuICAgICAgdmFyIGxhc3QgPSB0aGlzLnN0ZXBzW3RoaXMuc3RlcHMubGVuZ3RoLTFdO1xuICAgICAgZCA9IGxhc3QucDIgKyBsYXN0LnBhZDtcbiAgICB9XG5cbiAgICAvLyBhcHBlbmQgbmV3IHN0ZXBzXG4gICAgZm9yICh2YXIgaT0wOyBpPHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHNbaV0ucDEgPSBkO1xuICAgICAgc1tpXS5wMiA9IHNbaV0ucDEgKyBzW2ldLnNpemU7XG4gICAgICBkID0gc1tpXS5wMiArIHNbaV0ucGFkO1xuICAgICAgdGhpcy5zdGVwcy5wdXNoKCBzW2ldICk7XG4gICAgfVxuXG4gICAgLy8gcmVjYWxjdWxhdGUgcGFuZSBzaXplXG4gICAgdGhpcy5nZXRIZWlnaHQoIHRydWUgKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cblxuICAvKipcbiAgICogR2V0IHN0ZXAgYnkgaW5kZXhcbiAgICogQHBhcmFtIGluZGV4XG4gICAqL1xuICBnZXRTdGVwQXQoIGluZGV4ICkge1xuICAgIHJldHVybiB0aGlzLnN0ZXBzWyBNYXRoLm1heCggMCwgTWF0aC5taW4oIHRoaXMuc3RlcHMubGVuZ3RoLTEsIGluZGV4KSApXTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBhbmQgcmV0dXJuIGN1cnJlbnQgc3RlcC4gV2hlbiBwYWRkaW5nID4gMCwgc3RlcCB3aWxsIGJlIC0xIHdoZW4gY3VycmVudCBwcm9ncmVzcyBpcyBvbiB0aGUgcGFkZGluZyBhcmVhLiBUaGlzIGFsbG93cyB5b3UgdG8gY2hlY2sgcHJvZ3Jlc3MgYWdhaW5zdCBwYWRkaW5nLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0U3RlcCgpIHtcbiAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHN0ID0gdGhpcy5zdGVwc1tpXTtcbiAgICAgIGlmIChzdC5wMSA+PSAtdGhpcy52aWV3cG9ydFNpemUgJiYgc3QucDIgPD0gc3Quc2l6ZSApIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gaTtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBwcm9ncmVzcyB3aXRoaW4gdGhlIGN1cnJlbnQgc3RlcFxuICAgKiBAcmV0dXJucyAwLTEgaWYgc3RlcC5wYWQgaXMgMC4gT3RoZXJ3aXNlIGl0IHdpbGwgcmFuZ2UgZnJvbSBuZWdhdGl2ZSB0byBwb3NpdGl2ZS5cbiAgICovXG4gIGdldFN0ZXBQcm9ncmVzcygpIHtcbiAgICB2YXIgY3VyciA9IHRoaXMuc3RlcHNbIHRoaXMuY3VycmVudCBdO1xuICAgIHJldHVybiAxIC0gKGN1cnIucDIgLyBjdXJyLnNpemUpO1xuICB9XG5cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgcG9zaXRpb25cbiAgICogQHJldHVybnMge251bWJlcnwqfVxuICAgKi9cbiAgZ2V0UG9zaXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucG9zO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0b3RhbCBoZWlnaHQgb2YgdGhlIHBhbmUgKGluY2x1ZGluZyBwYWRkaW5nKVxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGdldEhlaWdodCggcmVjYWxjID0gZmFsc2UgKSB7XG4gICAgaWYgKHJlY2FsYyApIHRoaXMucGFuZVNpemUgPSB0aGlzLnN0ZXBzLnJlZHVjZSggKGEsYikgPT4gYStiLnNpemUrYi5wYWQsIDAgKTtcbiAgICByZXR1cm4gdGhpcy5wYW5lU2l6ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdmlld3BvcnQncyBoZWlnaHQgKHNhbWUgYXMgdGhpcy52aWV3cG9ydFNpemUpXG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgZ2V0Vmlld3BvcnRIZWlnaHQoKSB7XG4gICAgcmV0dXJuIHRoaXMudmlld3BvcnRTaXplO1xuICB9XG5cblxuICAvKipcbiAgICogTW92ZSB0aGUgcm9sbC4gVGhpcyB3aWxsIGVtaXQgdHdvIGV2ZW50cyBgcm9sbChzdGVwLCBjdXJyUHJvZ3Jlc3MsIGN1cnJQb3NpdGlvbiwgdG90YWxQcm9ncmVzcylgIGFuZCBgc3RlcChjdXJyLCBsYXN0KWBcbiAgICogQHBhcmFtIHBvcyBuZXcgcG9zaXRpb25cbiAgICogQHJldHVybnMge1JvbGx9XG4gICAqL1xuICBtb3ZlKCBwb3MgKSB7XG4gICAgdmFyIGxhc3QgPSB0aGlzLnBvcztcbiAgICB0aGlzLnBvcyA9IC1wb3M7XG4gICAgdmFyIGRpZmYgPSB0aGlzLnBvcyAtIGxhc3Q7XG5cbiAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IHMgPSB0aGlzLnN0ZXBzW2ldO1xuICAgICAgcy5wMSArPSBkaWZmO1xuICAgICAgcy5wMiA9IHMucDEgKyBzLnNpemU7XG4gICAgfVxuXG4gICAgdmFyIGN1cnIgPSB0aGlzLmdldFN0ZXAoKTtcbiAgICB2YXIgcHJvZ3Jlc3MgPSB0aGlzLmdldFN0ZXBQcm9ncmVzcygpO1xuICAgIHRoaXMuZW1pdChcInJvbGxcIiwgY3VyciwgcHJvZ3Jlc3MsIHBvcywgcG9zLyh0aGlzLnBhbmVTaXplLXRoaXMudmlld3BvcnRTaXplKSApO1xuXG4gICAgaWYgKGN1cnIgIT0gdGhpcy5sYXN0ICYmIGN1cnIgPj0gMCkge1xuICAgICAgdGhpcy5lbWl0KFwic3RlcFwiLCBjdXJyLCB0aGlzLmxhc3QsIHRoaXMudmlld3BvcnRTaXplICk7XG4gICAgICB0aGlzLmxhc3QgPSBjdXJyO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cblxuICAvKipcbiAgICogQW5pbWF0ZWQgc2Nyb2xsaW5nIGEgRE9NIGVsZW1lbnRcbiAgICogQHBhcmFtIGluZGV4IHN0ZXAgaW5kZXhcbiAgICogQHBhcmFtIHNjcm9sbFBhbmUgYSBET00gZWxlbWVudCB3aXRoIHNjcm9sbGluZyAob3ZlcmZsb3cteSkuXG4gICAqIEBwYXJhbSBzcGVlZCBvcHRpb25hbCBzcGVlZCBvZiBhbmltYXRlZCBzY3JvbGwuIERlZmF1bHRzIHRvIDAuMS4gTGFyZ2VyIGlzIGZhc3RlclxuICAgKiBAcGFyYW0gaXNWZXJ0aWNhbCBvcHRpb25hbCBib29sZWFuIHRvIGluZGljYXRlIGhvcml6b250YWwgb3IgdmVydGljYWwgc2Nyb2xsXG4gICAqL1xuICBzY3JvbGwoIGluZGV4LCBzY3JvbGxQYW5lLCBzcGVlZD0wLjEsIGlzVmVydGljYWw9dHJ1ZSkge1xuICAgIGlmICghc2Nyb2xsUGFuZSB8fCBzY3JvbGxQYW5lLnNjcm9sbFRvcCA9PSBudWxsKSB0aHJvdyBcInNjcm9sbFBhbmUgcGFyYW1ldGVyIHJlcXVpcmVzIGEgRE9NIGVsZW1lbnQgd2l0aCBzY3JvbGxUb3AgcHJvcGVydHlcIjtcbiAgICBjbGVhckludGVydmFsKCB0aGlzLm1vdmluZ0ludGVydmFsICk7XG4gICAgdmFyIF90ZW1wID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZO1xuICAgIHZhciBkaXIgPSAoaXNWZXJ0aWNhbCkgPyBcInNjcm9sbFRvcFwiIDogXCJzY3JvbGxMZWZ0XCI7XG5cbiAgICB0aGlzLm1vdmluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoICgpID0+IHtcbiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFN0ZXBBdChpbmRleCk7XG4gICAgICB2YXIgZCA9ICh0YXJnZXQucDEgKyB0YXJnZXQuc2l6ZS80KSAqIHNwZWVkO1xuICAgICAgc2Nyb2xsUGFuZVtkaXJdICs9IGQ7XG4gICAgICBpZiAoTWF0aC5hYnMoZCk8MSB8fCBfdGVtcCA9PT0gc2Nyb2xsUGFuZVtkaXJdKSBjbGVhckludGVydmFsKHRoaXMubW92aW5nSW50ZXJ2YWwpO1xuICAgICAgX3RlbXAgPSBzY3JvbGxQYW5lW2Rpcl07XG4gICAgfSwgMTcpO1xuICB9XG5cblxuICAvKipcbiAgICogQSBjb252ZW5pZW50IHN0YXRpYyBmdW5jdGlvbiB0byBjcmVhdGUgYSBzdGVwIG9iamVjdFxuICAgKiBAcGFyYW0gc2l6ZSBjaHVuayBzaXplXG4gICAqIEBwYXJhbSBwYWQgb3B0aW9uYWwgcGFkZGluZyAoZGVmYXVsdCB0byAwKVxuICAgKiBAcmV0dXJucyB7e3AxOiBudW1iZXIsIHAyOiAqLCBzaXplOiAqLCBwYWQ6IG51bWJlcn19XG4gICAqL1xuICBzdGF0aWMgY2h1bmsoIHNpemUsIHBhZD0wKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHAxOiAwLFxuICAgICAgcDI6IHNpemUsXG4gICAgICBzaXplOiBzaXplLFxuICAgICAgcGFkOiBwYWRcbiAgICB9XG4gIH1cblxuXG4gIC8qKlxuICAgKiBBIGNvbnZlbmllbnQgc3RhdGljIGZ1bmN0aW9uIHRvIGNvbXBhcmUgYSBzdGVwIHdpdGggY3VycmVudCBzdGVwLCBhbmQgdHJhbnNmb3JtIGl0IHRvIGEgbmFtZVxuICAgKiBAcGFyYW0gc3RlcCB0aGUgc3RlcCB0byBjaGVja1xuICAgKiBAcGFyYW0gY3VyclN0ZXAgY3VycmVudCBzdGVwXG4gICAqIEBwYXJhbSBwcmV2IG9wdGlvbmFsIGNsYXNzIG5hbWUgZm9yIHN0ZXAgaXMgPCBjdXJyU3RlcC4gRGVmYXVsdHMgdG8gXCJwcmV2XCJcbiAgICogQHBhcmFtIG5leHQgb3B0aW9uYWwgY2xhc3MgbmFtZSBmb3Igc3RlcCBpcyA+IGN1cnJTdGVwLiBEZWZhdWx0cyB0byBcIm5leHRcIlxuICAgKiBAcGFyYW0gbWF0Y2ggb3B0aW9uYWwgY2xhc3MgbmFtZSBmb3Igc3RlcCA9IGN1cnJTdGVwLiBEZWZhdWx0cyB0byBcImN1cnJcIlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgKi9cbiAgc3RhdGljIHN0ZXBOYW1lKCBzdGVwLCBjdXJyU3RlcCwgcHJldj1cInByZXZcIiwgbmV4dD1cIm5leHRcIiwgbWF0Y2g9XCJjdXJyXCIpIHtcbiAgICByZXR1cm4gKHN0ZXAgPT09IGN1cnJTdGVwKSA/IG1hdGNoIDogKCAoc3RlcCA8IGN1cnJTdGVwKSA/IHByZXYgOiBuZXh0ICk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBTdGF0aWMgaGVscGVyIHRvIGdldCBhIGhhbmRsZSBmdW5jdGlvbiBmb3IgUm9sbCdzIFwic3RlcFwiIGV2ZW50LiBUaGUgaGFuZGxlciBmdW5jdGlvbiB3aWxsIGFkZCBjbGFzcyBuYW1lcyB0byBlYWNoIHN0ZXAgZWxlbWVudCBiYXNlZCBvbiBjdXJyZW50IHN0ZXAgdmFsdWUuXG4gICAqIEBwYXJhbSByb2xsIGEgUm9sbCBpbnN0YW5jZVxuICAgKiBAcGFyYW0gdmlld3MgYSBsaXN0IG9mIERPTSBlbGVtZW50cyB3aGljaCBhcmUgdGhlIHN0ZXBzXG4gICAqIEBwYXJhbSBwcmV2IG9wdGlvbmFsIGNsYXNzIG5hbWUgZm9yIHN0ZXAgaXMgPCBjdXJyU3RlcC4gRGVmYXVsdHMgdG8gXCJwcmV2XCJcbiAgICogQHBhcmFtIG5leHQgb3B0aW9uYWwgY2xhc3MgbmFtZSBmb3Igc3RlcCBpcyA+IGN1cnJTdGVwLiBEZWZhdWx0cyB0byBcIm5leHRcIlxuICAgKiBAcGFyYW0gbWF0Y2ggb3B0aW9uYWwgY2xhc3MgbmFtZSBmb3Igc3RlcCA9IGN1cnJTdGVwLiBEZWZhdWx0cyB0byBcImN1cnJcIlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259XG4gICAqL1xuICBzdGF0aWMgc3RlcEhhbmRsZXIoIHJvbGwsIHZpZXdzLCBwcmV2PVwicHJldlwiLCBuZXh0PVwibmV4dFwiLCBtYXRjaD1cImN1cnJcIiwgdHJhY2tUb3BQb3M9ZmFsc2UpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCBjdXJyLCBsYXN0LCB2aWV3cG9ydEhlaWdodCApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9sbC5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgY2xzID0gUm9sbC5zdGVwTmFtZSggaSwgY3VyciwgcHJldiwgbmV4dCwgbWF0Y2ggKTtcbiAgICAgICAgdmlld3NbaV0uY2xhc3NOYW1lID0gXCJzdGVwIFwiICsgY2xzO1xuXG4gICAgICAgIC8vIGlmIHN0ZXBzIGhhdmUgZGlmZmVyZW50IHNpemVzLCByZWNhbGMgdG9wIHBvc2l0aW9uIGFuZCBzZXQgc3R5bGVcbiAgICAgICAgaWYgKHRyYWNrVG9wUG9zKSB7XG4gICAgICAgICAgdmFyIHAgPSAoY2xzPT09cHJldikgPyAgcm9sbC5zdGVwc1tpXS5zaXplICogLTEgOiAoKGNscz09PW5leHQpID8gdmlld3BvcnRIZWlnaHQgOiAwKTtcbiAgICAgICAgICB2aWV3c1tpXS5zdHlsZS50b3AgPSBwK1wicHhcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cbiAgLyoqXG4gICAqIFN0YXRpYyBtZXRob2QgdG8gY3JlYXRlIGEgUm9sbCBpbnN0YW5jZSB3aXRoIERPTSBlbGVtZW50c1xuICAgKiBAcGFyYW0gdmlld1BvcnRJRCBpZCBvZiB2aWV3cG9ydCBlbGVtZW50LCB3aGljaCBpcyB0aGUgcGFyZW50IG9mIHRoZSB2aWV3UGFuZS4gZWcsIFwiI3ZpZXdwb3J0XCJcbiAgICogQHBhcmFtIHZpZXdQYW5lSUQgaWQgb2YgdmlldyBwYW5lIGVsZW1lbnQsIGVnLCBcIiNwYW5lXCJcbiAgICogQHBhcmFtIHZpZXdCb3ggaWQgb2YgdmlldyBib3ggZWxlbWVudCwgd2hpY2ggaXMgdGhlIHBhcmVudCB0aGUgdmlld0NsYXNzIGVsZW1lbnRzLiBlZywgXCIjc3RlcHNcIlxuICAgKiBAcGFyYW0gdmlld0NsYXNzIGlkIG9mIGVhY2ggc3RlcCBvciBzbGlkZSBlbGVtZW50LCBlZywgXCIuc3RlcFwiXG4gICAqIEBwYXJhbSBwYWQgb3B0aW9uYWwgcGFkZGluZyBiZXR3ZWVuIHN0ZXBzLiBEZWZhdWx0cyB0byAwLlxuICAgKiBAcmV0dXJucyB0aGUgcm9sbCBpbnN0YW5jZSB3aGljaCB5b3UgY2FuIGxpc3RlbiBmb3IgXCJzdGVwXCIgYW5kIFwicm9sbFwiIGV2ZW50IHZpYSBgcm9sbC5vbiguLi4pYFxuICAgKi9cbiAgc3RhdGljIERPTSggdmlld1BvcnRJRCwgdmlld1BhbmVJRCwgdmlld0JveElELCB2aWV3Q2xhc3MsIHBhZD0wICkge1xuXG4gICAgdmFyIHZpZXdwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggdmlld1BvcnRJRCApO1xuICAgIHZhciB2aWV3cGFuZSA9IHZpZXdwb3J0LnF1ZXJ5U2VsZWN0b3IoIHZpZXdQYW5lSUQgKTtcbiAgICB2YXIgdmlld2JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIHZpZXdCb3hJRCApO1xuICAgIHZhciB2aWV3cyA9IHZpZXdib3gucXVlcnlTZWxlY3RvckFsbCggdmlld0NsYXNzICk7XG5cbiAgICBpZiAoIXZpZXdwb3J0IHx8ICF2aWV3cGFuZSkgdGhyb3cgYENhbm5vdCBmaW5kICR7dmlld1BvcnRJRH0gb3IgJHt2aWV3UGFuZUlEfSBlbGVtZW50IGlkLmBcbiAgICBpZiAoIXZpZXdDbGFzcykgdGhyb3cgYENhbm5vdCBmaW5kICR7dmlld0NsYXNzfSBlbGVtZW50IGNsYXNzIG5hbWVgO1xuXG4gICAgLy8gY3JlYXRlIHJvbGwgaW5zdGFuY2UgYmFzZWQgb24gdmlld3BvcnQgZWxlbWVudCBoZWlnaHRcbiAgICB2YXIgcm9sbCA9IG5ldyBSb2xsKCB2aWV3cG9ydC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgKTtcblxuICAgIC8vIGFkZCBlYWNoIHZpZXdDbGFzcyBlbGVtZW50IGFzIGEgc3RlcFxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlld3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciByZWN0ID0gdmlld3NbaV0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICByb2xsLmFkZFN0ZXAoIFJvbGwuY2h1bmsoIHJlY3QuaGVpZ2h0LCBwYWQgKSApO1xuICAgIH1cblxuICAgIC8vIHVwZGF0ZSB2aWV3cGFuZSBoZWlnaHQgYmFzZWQgb24gc3RlcHNcbiAgICB2aWV3cGFuZS5zdHlsZS5oZWlnaHQgPSByb2xsLmdldEhlaWdodCgpK1wicHhcIjtcblxuICAgIC8vIHVwZGF0ZSB2aWV3Ym94IHdpZHRoIHRvIGFjY291bnQgZm9yIHNjcm9sbGJhclxuICAgIHZpZXdib3guc3R5bGUud2lkdGggPSB2aWV3cGFuZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCtcInB4XCI7XG5cbiAgICAvLyB0cmFjayBzY3JvbGxcbiAgICB2aWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uKGV2dCkge1xuICAgICAgcm9sbC5tb3ZlKCB2aWV3cG9ydC5zY3JvbGxUb3AgKTtcbiAgICB9KTtcblxuICAgIHJldHVybiByb2xsO1xuICB9XG5cbn1cbiIsInZhciBSb2xsID0gcmVxdWlyZShcIi4vY2xpZW50LmpzXCIpO1xuXG5pZiAod2luZG93KSB3aW5kb3cuUm9sbCA9IFJvbGw7XG5cbiJdfQ=="}